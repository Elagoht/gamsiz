<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Musical Scale Finder</title>
    <style>
      :root {
        --bg-primary: #ffffff;
        --bg-secondary: #f5f5f5;
        --bg-note: #e0e0e0;
        --bg-note-active: #4caf50;
        --text-primary: #212121;
        --text-secondary: #757575;
        --border-color: #bdbdbd;
        --shadow: rgba(0, 0, 0, 0.1);
        --play-btn-bg: #2196f3;
        --play-btn-hover: #1976d2;
      }

      @media (prefers-color-scheme: dark) {
        :root {
          --bg-primary: #1a1a1a;
          --bg-secondary: #2d2d2d;
          --bg-note: #3a3a3a;
          --bg-note-active: #4caf50;
          --text-primary: #e0e0e0;
          --text-secondary: #a0a0a0;
          --border-color: #4a4a4a;
          --shadow: rgba(0, 0, 0, 0.3);
          --play-btn-bg: #2196f3;
          --play-btn-hover: #1976d2;
        }

        .piano-selector .white-key {
          color: #000000 !important;
        }

        .piano-selector .white-key.selected {
          color: white !important;
        }
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          Oxygen, Ubuntu, Cantarell, sans-serif;
        background-color: var(--bg-primary);
        color: var(--text-primary);
        padding: 20px;
        transition: background-color 0.3s, color 0.3s;
      }

      .container {
        max-width: 900px;
        margin: 0 auto;
      }

      h1 {
        text-align: center;
        margin-bottom: 10px;
        font-size: 2rem;
      }

      .subtitle {
        text-align: center;
        color: var(--text-secondary);
        margin-bottom: 30px;
        font-size: 0.95rem;
      }

      .piano-selector {
        background-color: var(--bg-secondary);
        border: 2px solid var(--border-color);
        border-radius: 12px;
        padding: 20px;
        margin-bottom: 30px;
        width: 100%;
      }

      .piano-selector-keyboard {
        display: flex;
        width: 100%;
        height: 140px;
        position: relative;
      }

      .piano-selector .key {
        position: relative;
        cursor: pointer;
        user-select: none;
      }

      .piano-selector .white-key {
        flex: 1;
        height: 140px;
        background-color: white;
        border: 1px solid var(--border-color);
        border-radius: 0 0 6px 6px;
        display: flex;
        align-items: flex-end;
        justify-content: center;
        padding-bottom: 12px;
        font-size: 0.9rem;
        font-weight: 600;
        color: #000000;
        z-index: 1;
        margin: 0 1px;
      }

      .piano-selector .white-key:hover {
        background-color: #f0f0f0;
      }

      .piano-selector .white-key.selected {
        background-color: var(--bg-note-active);
        color: #ffffff !important;
        border-color: var(--bg-note-active);
      }

      .piano-selector .white-key.selected:hover {
        background-color: #45a049;
      }

      .piano-selector .black-key {
        width: 55px;
        height: 90px;
        background-color: #333;
        border-radius: 0 0 4px 4px;
        position: absolute;
        z-index: 2;
        display: flex;
        align-items: flex-end;
        justify-content: center;
        padding-bottom: 8px;
        font-size: 0.75rem;
        font-weight: 600;
        color: white;
      }

      .piano-selector .black-key:hover {
        background-color: #555;
      }

      .piano-selector .black-key.selected {
        background-color: #2e7d32;
      }

      .piano-selector .black-key.selected:hover {
        background-color: #1b5e20;
      }

      .piano-selector .key-label {
        pointer-events: none;
        user-select: none;
      }

      @media (max-width: 600px) {
        .piano-selector-keyboard {
          height: 100px;
        }

        .piano-selector .white-key {
          height: 100px;
          font-size: 0.75rem;
          padding-bottom: 8px;
        }

        .piano-selector .black-key {
          width: 45px;
          height: 65px;
          font-size: 0.6rem;
          padding-bottom: 5px;
        }
      }

      .scales-section {
        margin-top: 30px;
      }

      .scales-header {
        font-size: 1.3rem;
        margin-bottom: 15px;
        padding-bottom: 10px;
        border-bottom: 2px solid var(--border-color);
      }

      .no-scales {
        text-align: center;
        color: var(--text-secondary);
        padding: 40px;
        font-size: 1rem;
      }

      .scale-item {
        position: relative;
        background-color: var(--bg-secondary);
        border: 1px solid var(--border-color);
        border-radius: 8px;
        padding: 15px;
        margin-bottom: 12px;
        transition: all 0.2s;
        cursor: pointer;
      }

      .scale-content {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
      }

      .scale-item:hover {
        box-shadow: 0 2px 8px var(--shadow);
      }

      .scale-item.selected {
        border: 2px solid #2196f3;
        background-color: var(--bg-primary);
        box-shadow: 0 4px 12px var(--shadow);
      }

      .scale-item.selected::before {
        content: "‚å® Selected - Use QWER/ASDF/ZXCV";
        position: absolute;
        top: -10px;
        left: 15px;
        background-color: #2196f3;
        color: white;
        padding: 2px 8px;
        border-radius: 4px;
        font-size: 0.75rem;
        font-weight: 600;
      }

      .scale-info {
        flex: 1;
      }

      .scale-name {
        font-size: 1.1rem;
        font-weight: 600;
        margin-bottom: 5px;
      }

      .scale-notes {
        color: var(--text-secondary);
        font-size: 0.9rem;
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        align-items: center;
      }

      .note-badge {
        position: relative;
        padding: 4px 8px;
        border-radius: 4px;
        background-color: var(--bg-note);
        color: var(--text-secondary);
        font-weight: 500;
        transition: all 0.2s;
        cursor: pointer;
        user-select: none;
      }

      .scale-item.selected .note-badge::after {
        content: attr(data-key-index);
        position: absolute;
        top: -6px;
        right: -6px;
        background-color: #2196f3;
        color: white;
        border-radius: 50%;
        width: 16px;
        height: 16px;
        font-size: 0.65rem;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 600;
      }

      .note-badge:hover {
        transform: translateY(-1px);
        box-shadow: 0 2px 4px var(--shadow);
      }

      .note-badge.selected {
        background-color: var(--bg-note-active);
        color: white;
        font-weight: 600;
      }

      .note-badge.playing {
        background-color: #9c27b0;
        color: white;
        font-weight: 600;
        transform: scale(1.1);
      }

      .note-badge.clicked {
        animation: noteClick 0.3s ease;
      }

      @keyframes noteClick {
        0% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.15);
        }
        100% {
          transform: scale(1);
        }
      }

      .play-button {
        background-color: var(--play-btn-bg);
        color: white;
        border: none;
        border-radius: 6px;
        padding: 10px 20px;
        font-size: 0.9rem;
        font-weight: 600;
        cursor: pointer;
        transition: background-color 0.2s;
        display: flex;
        align-items: center;
        gap: 5px;
      }

      .play-button:hover {
        background-color: var(--play-btn-hover);
      }

      .play-button:active {
        transform: scale(0.95);
      }

      .play-button.playing {
        background-color: #f44336;
        cursor: pointer;
      }

      .play-button.playing:hover {
        background-color: #d32f2f;
      }

      /* Instrument Visualization Styles */
      .instrument-section {
        margin-top: 30px;
        display: none;
      }

      .instrument-section.active {
        display: block;
      }

      .instrument-header {
        font-size: 1.1rem;
        font-weight: 600;
        margin-bottom: 15px;
        color: var(--text-primary);
      }

      /* Guitar Fretboard Styles */
      .guitar-fretboard {
        background-color: var(--bg-secondary);
        border: 2px solid var(--border-color);
        border-radius: 8px;
        padding: 20px;
        margin-bottom: 20px;
        overflow-x: auto;
      }

      .fretboard {
        display: flex;
        flex-direction: column;
        gap: 8px;
        min-width: 800px;
      }

      .string {
        display: flex;
        align-items: center;
        height: 40px;
        position: relative;
      }

      .string-label {
        position: absolute;
        left: -30px;
        width: 25px;
        text-align: center;
        font-weight: 600;
        color: var(--text-secondary);
        font-size: 0.9rem;
      }

      .string-line {
        position: absolute;
        top: 50%;
        left: 0;
        right: 0;
        height: 2px;
        background-color: var(--border-color);
        z-index: 1;
      }

      .fret {
        flex: 1;
        min-width: 60px;
        height: 40px;
        border-right: 3px solid var(--border-color);
        position: relative;
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 2;
      }

      .fret:nth-child(3n) {
        border-right-width: 5px;
        border-color: #999;
      }

      .fret-number {
        position: absolute;
        bottom: -20px;
        font-size: 0.75rem;
        color: var(--text-secondary);
        font-weight: 500;
      }

      .note-marker {
        width: 28px;
        height: 28px;
        border-radius: 50%;
        background-color: var(--bg-note);
        border: 2px solid var(--border-color);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 0.75rem;
        font-weight: 600;
        color: var(--text-primary);
        cursor: pointer;
        transition: all 0.2s;
        z-index: 3;
      }

      .note-marker.in-scale {
        background-color: var(--bg-note-active);
        color: white;
        border-color: var(--bg-note-active);
        transform: scale(1.1);
      }

      .note-marker:hover {
        transform: scale(1.2);
        box-shadow: 0 2px 8px var(--shadow);
      }

      .note-marker.in-scale:hover {
        transform: scale(1.3);
      }

      .fret-markers {
        position: absolute;
        top: 10px;
        left: 0;
        right: 0;
        display: flex;
        justify-content: space-around;
        pointer-events: none;
      }

      .fret-marker {
        width: 8px;
        height: 8px;
        border-radius: 50%;
        background-color: var(--border-color);
      }

      /* Piano Keys Styles */
      .piano-keyboard {
        background-color: var(--bg-secondary);
        border: 2px solid var(--border-color);
        border-radius: 8px;
        padding: 20px;
        overflow-x: auto;
      }

      .keyboard {
        display: flex;
        min-width: 700px;
        height: 120px;
        position: relative;
      }

      .key {
        position: relative;
        cursor: pointer;
        transition: all 0.1s;
      }

      .white-key {
        width: 50px;
        height: 120px;
        background-color: white;
        border: 1px solid var(--border-color);
        border-radius: 0 0 4px 4px;
        display: flex;
        align-items: flex-end;
        justify-content: center;
        padding-bottom: 8px;
        font-size: 0.75rem;
        font-weight: 600;
        color: var(--text-primary);
        z-index: 1;
      }

      .white-key:hover {
        background-color: #f0f0f0;
      }

      .white-key.in-scale {
        background-color: var(--bg-note-active);
        color: white;
      }

      .white-key.in-scale:hover {
        background-color: #45a049;
      }

      .black-key {
        width: 35px;
        height: 80px;
        background-color: #333;
        border-radius: 0 0 3px 3px;
        position: absolute;
        z-index: 2;
        display: flex;
        align-items: flex-end;
        justify-content: center;
        padding-bottom: 6px;
        font-size: 0.65rem;
        font-weight: 600;
        color: white;
      }

      .black-key:hover {
        background-color: #555;
      }

      .black-key.in-scale {
        background-color: #2196f3;
      }

      .black-key.in-scale:hover {
        background-color: #1976d2;
      }

      .key:active {
        transform: translateY(1px);
      }

      .key-label {
        pointer-events: none;
        user-select: none;
      }

      /* Scale Instrument Styles */
      .scale-instruments {
        margin-top: 20px;
        padding-top: 15px;
        border-top: 1px solid var(--border-color);
        width: 100%;
      }

      .instruments-row {
        display: flex;
        gap: 15px;
        margin-top: 10px;
      }

      .instrument-wrapper {
        flex: 1;
        min-width: 0; /* Allows flex items to shrink properly */
      }

      .instrument-header-scale {
        font-size: 0.9rem;
        font-weight: 600;
        margin-bottom: 8px;
        color: var(--text-primary);
      }

      .guitar-fretboard-scale {
        background-color: var(--bg-secondary);
        border: 1px solid var(--border-color);
        border-radius: 6px;
        padding: 12px;
        overflow-x: auto;
      }

      .fretboard-scale {
        display: flex;
        flex-direction: column;
        gap: 6px;
        min-width: 600px;
      }

      .fretboard-scale .string {
        display: flex;
        align-items: center;
        height: 30px;
        position: relative;
      }

      .fretboard-scale .string-label {
        position: absolute;
        left: -25px;
        width: 20px;
        text-align: center;
        font-weight: 600;
        color: var(--text-secondary);
        font-size: 0.8rem;
      }

      .fretboard-scale .string-line {
        position: absolute;
        top: 50%;
        left: 0;
        right: 0;
        height: 1px;
        background-color: var(--border-color);
        z-index: 1;
      }

      .fretboard-scale .fret {
        flex: 1;
        min-width: 45px;
        height: 30px;
        border-right: 2px solid var(--border-color);
        position: relative;
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 2;
      }

      .fretboard-scale .fret:nth-child(3n) {
        border-right-width: 3px;
        border-color: #999;
      }

      .fretboard-scale .note-marker {
        width: 20px;
        height: 20px;
        border-radius: 50%;
        background-color: var(--bg-note);
        border: 1px solid var(--border-color);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 0.65rem;
        font-weight: 600;
        color: var(--text-primary);
        cursor: pointer;
        transition: all 0.2s;
        z-index: 3;
      }

      .fretboard-scale .note-marker.in-scale {
        background-color: var(--bg-note-active);
        color: white;
        border-color: var(--bg-note-active);
        transform: scale(1.1);
      }

      .fretboard-scale .note-marker:hover {
        transform: scale(1.2);
        box-shadow: 0 2px 6px var(--shadow);
      }

      .fretboard-scale .note-marker.in-scale:hover {
        transform: scale(1.3);
      }

      .fretboard-scale .note-marker.clicked {
        animation: noteClick 0.3s ease;
      }

      .piano-keyboard-scale {
        background-color: var(--bg-secondary);
        border: 1px solid var(--border-color);
        border-radius: 6px;
        padding: 12px;
      }

      .keyboard-scale {
        display: flex;
        width: 100%;
        height: 120px;
        position: relative;
      }

      .keyboard-scale .key {
        position: relative;
        cursor: pointer;
        transition: all 0.1s;
      }

      .keyboard-scale .white-key {
        flex: 1;
        height: 120px;
        background-color: white;
        border: 1px solid var(--border-color);
        border-radius: 0 0 3px 3px;
        display: flex;
        align-items: flex-end;
        justify-content: center;
        padding-bottom: 8px;
        font-size: 0.75rem;
        font-weight: 600;
        color: #000000;
        z-index: 1;
        min-width: 35px; /* Ensure minimum width for touch targets */
      }

      .keyboard-scale .white-key:hover {
        background-color: #f0f0f0;
      }

      .keyboard-scale .white-key.in-scale {
        background-color: var(--bg-note-active);
        color: #ffffff !important;
      }

      .keyboard-scale .white-key.in-scale:hover {
        background-color: #45a049;
      }

      .keyboard-scale .black-key {
        width: 25px;
        height: 75px;
        background-color: #333;
        border-radius: 0 0 2px 2px;
        position: absolute;
        z-index: 2;
        display: flex;
        align-items: flex-end;
        justify-content: center;
        padding-bottom: 4px;
        font-size: 0.5rem;
        font-weight: 600;
        color: white;
        max-width: 70%; /* Ensure black keys don't overflow on mobile */
      }

      .keyboard-scale .black-key:hover {
        background-color: #555;
      }

      .keyboard-scale .black-key.in-scale {
        background-color: #2e7d32;
      }

      .keyboard-scale .black-key.in-scale:hover {
        background-color: #1b5e20;
      }

      .keyboard-scale .key.clicked {
        animation: keyClick 0.3s ease;
      }

      @keyframes keyClick {
        0% {
          transform: translateY(0);
        }
        50% {
          transform: translateY(2px);
        }
        100% {
          transform: translateY(0);
        }
      }

      @media (max-width: 600px) {
        .note-grid {
          gap: 8px;
        }

        .note-button {
          font-size: 0.85rem;
        }

        h1 {
          font-size: 1.5rem;
        }

        .scale-content {
          flex-direction: column;
          align-items: flex-start;
          gap: 10px;
        }

        .play-button {
          width: 100%;
          justify-content: center;
        }

        .instruments-row {
          flex-direction: column;
          gap: 10px;
        }

        .fretboard-scale {
          min-width: 500px;
        }

        .keyboard-scale {
          min-width: auto; /* Remove min-width on mobile */
          height: 80px; /* Reduce height on mobile */
        }

        .keyboard-scale .white-key {
          height: 80px;
          font-size: 0.6rem;
          padding-bottom: 4px;
        }

        .keyboard-scale .black-key {
          height: 50px;
          font-size: 0.45rem;
          padding-bottom: 2px;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>Musical Scale Finder</h1>
      <p class="subtitle">Select at least 3 notes to find matching scales</p>

      <div class="piano-selector">
        <div class="piano-selector-keyboard" id="pianoSelector"></div>
      </div>

      <div class="scales-section" id="scalesSection">
        <h2 class="scales-header">Matching Scales</h2>
        <div id="scalesList">
          <div class="no-scales">
            Select 3 or more notes to see matching scales
          </div>
        </div>
      </div>

      </div>

    <!-- Instrument Visualizations -->
    <div class="instrument-section" id="guitarSection">
      <h3 class="instrument-header">üé∏ Guitar Fretboard</h3>
      <div class="guitar-fretboard">
        <div class="fretboard" id="fretboard"></div>
      </div>
    </div>

    <div class="instrument-section" id="pianoSection">
      <h3 class="instrument-header">üéπ Piano Keyboard</h3>
      <div class="piano-keyboard">
        <div class="keyboard" id="keyboard"></div>
      </div>
    </div>

    <script>
      const NOTES = [
        "C",
        "C#",
        "D",
        "D#",
        "E",
        "F",
        "F#",
        "G",
        "G#",
        "A",
        "A#",
        "B",
      ];

      // Define scales as intervals from root note (in semitones)
      const SCALES = {
        "Major (Ionian)": [0, 2, 4, 5, 7, 9, 11],
        "Natural Minor (Aeolian)": [0, 2, 3, 5, 7, 8, 10],
        "Harmonic Minor": [0, 2, 3, 5, 7, 8, 11],
        "Melodic Minor": [0, 2, 3, 5, 7, 9, 11],
        Dorian: [0, 2, 3, 5, 7, 9, 10],
        Phrygian: [0, 1, 3, 5, 7, 8, 10],
        Lydian: [0, 2, 4, 6, 7, 9, 11],
        Mixolydian: [0, 2, 4, 5, 7, 9, 10],
        Locrian: [0, 1, 3, 5, 6, 8, 10],
        "Major Pentatonic": [0, 2, 4, 7, 9],
        "Minor Pentatonic": [0, 3, 5, 7, 10],
        Blues: [0, 3, 5, 6, 7, 10],
        "Whole Tone": [0, 2, 4, 6, 8, 10],
        Chromatic: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11],
      };

      // Note frequencies (A4 = 440Hz)
      const NOTE_FREQUENCIES = {
        C: 261.63,
        "C#": 277.18,
        D: 293.66,
        "D#": 311.13,
        E: 329.63,
        F: 349.23,
        "F#": 369.99,
        G: 392.0,
        "G#": 415.3,
        A: 440.0,
        "A#": 466.16,
        B: 493.88,
      };

      // Function to get frequency with octave
      function getFrequencyWithOctave(note, octave) {
        const baseFreq = NOTE_FREQUENCIES[note];
        const octaveShift = octave - 4; // A4 is reference (octave 4)
        return baseFreq * Math.pow(2, octaveShift);
      }

      // Guitar string frequencies with correct octaves (standard tuning E-A-D-G-B-E)
      const GUITAR_STRING_FREQUENCIES = [
        { note: 'E', octave: 4, frequency: 329.63 }, // High E (1st string)
        { note: 'B', octave: 3, frequency: 246.94 }, // B (2nd string)
        { note: 'G', octave: 3, frequency: 196.00 }, // G (3rd string)
        { note: 'D', octave: 3, frequency: 146.83 }, // D (4th string)
        { note: 'A', octave: 2, frequency: 110.00 }, // A (5th string)
        { note: 'E', octave: 2, frequency: 82.41 },  // Low E (6th string)
      ];

      let selectedNotes = new Set();
      let audioContext = null;
      let currentlyPlayingIndex = null;
      let shouldStop = false;
      let selectedScaleIndex = null;

      // Initialize audio context on first user interaction
      function initAudioContext() {
        if (!audioContext) {
          audioContext = new (window.AudioContext ||
            window.webkitAudioContext)();
        }
      }

      // Create piano selector keyboard
      function createPianoSelector() {
        const pianoSelector = document.getElementById("pianoSelector");

        // Define white keys and black keys layout
        const whiteKeys = ['C', 'D', 'E', 'F', 'G', 'A', 'B'];
        const blackKeysMap = [
          { note: 'C#', between: [0, 1] }, // Between C and D
          { note: 'D#', between: [1, 2] }, // Between D and E
          { note: 'F#', between: [3, 4] }, // Between F and G
          { note: 'G#', between: [4, 5] }, // Between G and A
          { note: 'A#', between: [5, 6] }, // Between A and B
        ];

        // Create white keys
        whiteKeys.forEach((note, index) => {
          const key = document.createElement('div');
          key.className = 'key white-key';
          key.dataset.note = note;

          const label = document.createElement('div');
          label.className = 'key-label';
          label.textContent = note;
          key.appendChild(label);

          key.addEventListener("click", toggleNote);
          pianoSelector.appendChild(key);
        });

        // Create black keys (positioned absolutely)
        setTimeout(() => {
          const whiteKeyElements = pianoSelector.querySelectorAll('.white-key');
          const blackKeyWidth = window.innerWidth <= 600 ? 45 : 55;

          blackKeysMap.forEach((blackKeyData) => {
            const blackKey = document.createElement('div');
            blackKey.className = 'key black-key';
            blackKey.dataset.note = blackKeyData.note;

            // Get the white keys this black key sits between
            const leftWhiteKey = whiteKeyElements[blackKeyData.between[0]];
            const rightWhiteKey = whiteKeyElements[blackKeyData.between[1]];

            if (leftWhiteKey && rightWhiteKey) {
              const leftPosition = leftWhiteKey.offsetLeft;
              const whiteKeyWidth = leftWhiteKey.offsetWidth;

              // Position the black key so it overlaps slightly with both adjacent white keys
              const blackKeyPosition = leftPosition + whiteKeyWidth - (blackKeyWidth / 2);

              blackKey.style.left = `${blackKeyPosition}px`;
            }

            const label = document.createElement('div');
            label.className = 'key-label';
            label.textContent = blackKeyData.note;
            blackKey.appendChild(label);

            blackKey.addEventListener("click", toggleNote);
            pianoSelector.appendChild(blackKey);
          });
        }, 0);
      }

      // Toggle note selection
      function toggleNote(event) {
        initAudioContext();
        const note = event.currentTarget.dataset.note;
        const key = event.currentTarget;

        if (selectedNotes.has(note)) {
          selectedNotes.delete(note);
          key.classList.remove("selected");
        } else {
          selectedNotes.add(note);
          key.classList.add("selected");
        }

        updateScales();
      }

      // Get note index
      function getNoteIndex(note) {
        return NOTES.indexOf(note);
      }

      // Check if selected notes match a scale
      function matchesScale(selectedIndices, scaleIntervals, rootIndex) {
        const scaleNotes = scaleIntervals.map(
          (interval) => (rootIndex + interval) % 12
        );
        return selectedIndices.every((index) => scaleNotes.includes(index));
      }

      // Find all matching scales
      function findMatchingScales() {
        if (selectedNotes.size < 3) {
          return [];
        }

        const selectedIndices = Array.from(selectedNotes).map(getNoteIndex);
        const matches = [];

        // Try each note as root
        for (let rootIndex = 0; rootIndex < 12; rootIndex++) {
          const rootNote = NOTES[rootIndex];

          // Check each scale type
          for (const [scaleName, intervals] of Object.entries(SCALES)) {
            if (matchesScale(selectedIndices, intervals, rootIndex)) {
              const scaleNotes = intervals.map(
                (interval) => NOTES[(rootIndex + interval) % 12]
              );
              matches.push({
                name: `${rootNote} ${scaleName}`,
                notes: scaleNotes,
                root: rootNote,
              });
            }
          }
        }

        return matches;
      }

      // Update scales display
      function updateScales() {
        const scalesList = document.getElementById("scalesList");
        const matches = findMatchingScales();

        if (matches.length === 0) {
          if (selectedNotes.size < 3) {
            scalesList.innerHTML =
              '<div class="no-scales">Select 3 or more notes to see matching scales</div>';
          } else {
            scalesList.innerHTML =
              '<div class="no-scales">No matching scales found</div>';
          }
          return;
        }

        scalesList.innerHTML = matches
          .map((scale, index) => {
            const keyLabels = ["Q", "W", "E", "R", "A", "S", "D", "F", "Z", "X", "C", "V"];
            const notesHTML = scale.notes
              .map((note, noteIndex) => {
                const isSelected = selectedNotes.has(note);
                const keyLabel = keyLabels[noteIndex] || "";
                return `<span class="note-badge ${
                  isSelected ? "selected" : ""
                }" data-note="${note}" data-scale-index="${index}" data-key-index="${keyLabel}" onclick="playNoteClick(event, '${note}')">${note}</span>`;
              })
              .join("");

            const isPlaying = currentlyPlayingIndex === index;
            const isSelectedScale = selectedScaleIndex === index;
            const buttonText = isPlaying ? "‚èπ Stop" : "‚ñ∂ Play";
            const buttonClass = isPlaying
              ? "play-button playing"
              : "play-button";
            const buttonAction = isPlaying
              ? "stopScale()"
              : `playScale(${index})`;
            const scaleClass = isSelectedScale
              ? "scale-item selected"
              : "scale-item";

            // Add instrument sections inside selected scale
            const instrumentSections = isSelectedScale ? `
              <div class="scale-instruments">
                <div class="instruments-row">
                  <div class="instrument-wrapper">
                    <div class="instrument-header-scale">üé∏ Guitar</div>
                    <div class="guitar-fretboard-scale">
                      <div class="fretboard-scale" id="fretboard-${index}"></div>
                    </div>
                  </div>
                  <div class="instrument-wrapper">
                    <div class="instrument-header-scale">üéπ Piano</div>
                    <div class="piano-keyboard-scale">
                      <div class="keyboard-scale" id="keyboard-${index}"></div>
                    </div>
                  </div>
                </div>
              </div>
            ` : '';

            return `
                    <div class="${scaleClass}" onclick="selectScale(event, ${index})">
                        <div class="scale-content">
                            <div class="scale-info">
                                <div class="scale-name">${scale.name}</div>
                                <div class="scale-notes">${notesHTML}</div>
                            </div>
                            <button class="${buttonClass}" onclick="event.stopPropagation(); ${buttonAction}">
                                ${buttonText}
                            </button>
                        </div>
                        ${instrumentSections}
                    </div>
                `;
          })
          .join("");

        // Store matches for playback
        window.currentMatches = matches;

        // Update instrument visualizations
        updateInstrumentVisualizations();
      }

      // Play a scale
      async function playScale(index) {
        initAudioContext();
        const scale = window.currentMatches[index];

        if (currentlyPlayingIndex !== null) {
          return;
        }

        currentlyPlayingIndex = index;
        shouldStop = false;
        updateScales();

        for (const note of scale.notes) {
          if (shouldStop) {
            break;
          }

          // Highlight the current note
          const noteBadge = document.querySelector(
            `.note-badge[data-note="${note}"][data-scale-index="${index}"]`
          );
          if (noteBadge) {
            noteBadge.classList.add("playing");
          }

          await playNote(note, 0.3);

          // Remove highlight from the current note
          if (noteBadge) {
            noteBadge.classList.remove("playing");
          }

          if (!shouldStop) {
            await sleep(350);
          }
        }

        currentlyPlayingIndex = null;
        updateScales();
      }

      // Stop the currently playing scale
      function stopScale() {
        shouldStop = true;
      }

      // Play a note when clicked on badge
      async function playNoteClick(event, note) {
        initAudioContext();
        const badge = event.target;

        // Add click animation
        badge.classList.add("clicked");
        setTimeout(() => badge.classList.remove("clicked"), 300);

        // Play the note
        await playNote(note, 0.4);
      }

      // Play a guitar note with correct octave
      async function playGuitarNote(event, note, stringIndex, fretNumber) {
        initAudioContext();
        const marker = event.target;

        // Add click animation
        marker.classList.add("clicked");
        setTimeout(() => marker.classList.remove("clicked"), 300);

        // Calculate frequency based on string and fret
        const stringData = GUITAR_STRING_FREQUENCIES[stringIndex];
        const frequency = stringData.frequency * Math.pow(2, fretNumber / 12);

        // Play the note with calculated frequency
        await playNoteWithFrequency(frequency, 0.4);
      }

      // Play a note with custom frequency
      function playNoteWithFrequency(frequency, duration) {
        return new Promise((resolve) => {
          const now = audioContext.currentTime;

          // Create main oscillator (fundamental)
          const oscillator = audioContext.createOscillator();
          const gainNode = audioContext.createGain();

          // Create filter for guitar tone shaping
          const filter = audioContext.createBiquadFilter();
          filter.type = 'lowpass';
          filter.frequency.value = frequency * 8; // Bright tone
          filter.Q.value = 2;

          // Guitar-like envelope
          const attackTime = 0.003; // Pick attack
          const decayTime = 0.15;   // Initial decay
          const sustainLevel = 0.25; // Sustain level
          const releaseTime = Math.max(0.2, duration - 0.3);

          oscillator.connect(filter);
          filter.connect(gainNode);
          gainNode.connect(audioContext.destination);

          // Use sawtooth for rich harmonic content (steel string sound)
          oscillator.type = "sawtooth";
          oscillator.frequency.value = frequency;

          // Guitar envelope (ADSR)
          gainNode.gain.setValueAtTime(0, now);
          gainNode.gain.linearRampToValueAtTime(0.4, now + attackTime); // Pick attack
          gainNode.gain.exponentialRampToValueAtTime(sustainLevel, now + decayTime); // Decay to sustain
          gainNode.gain.exponentialRampToValueAtTime(0.01, now + duration); // Release

          // Add body resonance (low frequency boost)
          const bodyOscillator = audioContext.createOscillator();
          const bodyGain = audioContext.createGain();
          const bodyFilter = audioContext.createBiquadFilter();

          bodyFilter.type = 'lowpass';
          bodyFilter.frequency.value = frequency * 2;

          bodyOscillator.type = 'sine';
          bodyOscillator.frequency.value = frequency / 2; // One octave lower for body

          bodyOscillator.connect(bodyFilter);
          bodyFilter.connect(bodyGain);
          bodyGain.connect(gainNode);

          bodyGain.gain.setValueAtTime(0, now);
          bodyGain.gain.linearRampToValueAtTime(0.15, now + attackTime);
          bodyGain.gain.exponentialRampToValueAtTime(0.01, now + duration);

          // Add fret buzz and string noise (high frequency content)
          const noiseOscillator = audioContext.createOscillator();
          const noiseGain = audioContext.createGain();
          const noiseFilter = audioContext.createBiquadFilter();

          noiseFilter.type = 'highpass';
          noiseFilter.frequency.value = frequency * 12;
          noiseFilter.Q.value = 0.5;

          noiseOscillator.type = 'square'; // Rich harmonics
          noiseOscillator.frequency.value = frequency * 16; // High frequency noise

          noiseOscillator.connect(noiseFilter);
          noiseFilter.connect(noiseGain);
          noiseGain.connect(gainNode);

          noiseGain.gain.setValueAtTime(0.05, now);
          noiseGain.gain.exponentialRampToValueAtTime(0.001, now + 0.05); // Quick decay for attack noise

          // Add subtle vibrato for acoustic guitar feel
          const vibrato = audioContext.createOscillator();
          const vibratoGain = audioContext.createGain();

          vibrato.frequency.value = 4.5; // 4.5Hz vibrato
          vibratoGain.gain.value = 3; // 3 cents vibrato depth

          vibrato.connect(vibratoGain);
          vibratoGain.connect(oscillator.frequency);

          // Start all oscillators
          oscillator.start(now);
          bodyOscillator.start(now);
          noiseOscillator.start(now);
          vibrato.start(now);

          // Stop all oscillators
          oscillator.stop(now + duration);
          bodyOscillator.stop(now + duration);
          noiseOscillator.stop(now + duration);
          vibrato.stop(now + duration);

          oscillator.onended = resolve;
        });
      }

      // Select a scale for keyboard shortcuts
      function selectScale(event, index) {
        // Don't select if clicking on interactive elements
        if (event.target.classList.contains("note-badge") ||
            event.target.classList.contains("note-marker") ||
            event.target.classList.contains("key") ||
            event.target.classList.contains("key-label")) {
          return;
        }

        // Prevent re-selecting the same scale (avoid unnecessary re-renders)
        if (selectedScaleIndex === index) {
          return;
        }

        selectedScaleIndex = index;
        updateScales();
        updateInstrumentVisualizations();
      }

      // Handle keyboard shortcuts
      function handleKeyPress(event) {
        // Map keys to note indices
        const keyMap = {
          q: 0,
          w: 1,
          e: 2,
          r: 3,
          a: 4,
          s: 5,
          d: 6,
          f: 7,
          z: 8,
          x: 9,
          c: 10,
          v: 11,
        };

        const key = event.key.toLowerCase();
        if (!(key in keyMap)) {
          return;
        }

        // Check if a scale is selected
        if (selectedScaleIndex === null || !window.currentMatches) {
          return;
        }

        const scale = window.currentMatches[selectedScaleIndex];
        if (!scale) {
          return;
        }

        // Get the note at the index
        const noteIndex = keyMap[key];
        if (noteIndex >= scale.notes.length) {
          return;
        }

        const note = scale.notes[noteIndex];

        // Find and animate the badge
        const badge = document.querySelector(
          `.note-badge[data-note="${note}"][data-scale-index="${selectedScaleIndex}"]`
        );
        if (badge) {
          badge.classList.add("clicked");
          setTimeout(() => badge.classList.remove("clicked"), 300);
        }

        // Initialize audio and play the note
        initAudioContext();
        playNote(note, 0.4);
      }

      // Handle arrow key navigation
      function handleKeyDown(event) {
        if (event.key !== "ArrowUp" && event.key !== "ArrowDown") {
          return;
        }

        if (!window.currentMatches || window.currentMatches.length === 0) {
          return;
        }

        event.preventDefault();

        const totalScales = window.currentMatches.length;

        if (event.key === "ArrowDown") {
          if (selectedScaleIndex === null) {
            selectedScaleIndex = 0;
          } else {
            selectedScaleIndex = (selectedScaleIndex + 1) % totalScales;
          }
        } else if (event.key === "ArrowUp") {
          if (selectedScaleIndex === null) {
            selectedScaleIndex = totalScales - 1;
          } else {
            selectedScaleIndex = (selectedScaleIndex - 1 + totalScales) % totalScales;
          }
        }

        updateScales();

        // Scroll selected scale into view and center it
        const selectedElement = document.querySelector('.scale-item.selected');
        if (selectedElement) {
          selectedElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }
      }

      // Play a single note with piano-like synthesis
      function playNote(note, duration) {
        return new Promise((resolve) => {
          const now = audioContext.currentTime;
          const frequency = NOTE_FREQUENCIES[note];

          // Create main oscillator (fundamental)
          const oscillator = audioContext.createOscillator();
          const gainNode = audioContext.createGain();

          // Create filter for piano tone shaping
          const filter = audioContext.createBiquadFilter();
          filter.type = 'lowpass';
          filter.frequency.value = frequency * 6; // Warmer tone than guitar
          filter.Q.value = 1;

          // Piano-like envelope (hammer strike and sustain)
          const attackTime = 0.001; // Immediate hammer attack
          const decayTime = 0.25;   // Initial decay
          const sustainLevel = 0.15; // Lower sustain (damper effect)
          const releaseTime = Math.max(0.3, duration - 0.35); // Longer release

          oscillator.connect(filter);
          filter.connect(gainNode);
          gainNode.connect(audioContext.destination);

          // Use triangle wave for fundamental (mellow piano tone)
          oscillator.type = "triangle";
          oscillator.frequency.value = frequency;

          // Piano envelope with hammer strike simulation
          gainNode.gain.setValueAtTime(0, now);
          gainNode.gain.linearRampToValueAtTime(0.6, now + attackTime); // Hammer impact
          gainNode.gain.exponentialRampToValueAtTime(sustainLevel, now + decayTime); // Decay to sustain
          gainNode.gain.exponentialRampToValueAtTime(0.001, now + duration); // Release

          // Add hammer noise (attack transient)
          const hammerNoise = audioContext.createOscillator();
          const hammerGain = audioContext.createGain();
          const hammerFilter = audioContext.createBiquadFilter();

          hammerFilter.type = 'highpass';
          hammerFilter.frequency.value = frequency * 20;
          hammerFilter.Q.value = 0.3;

          hammerNoise.type = 'square'; // Rich harmonic content
          hammerNoise.frequency.value = frequency * 25; // High frequency noise

          hammerNoise.connect(hammerFilter);
          hammerFilter.connect(hammerGain);
          hammerGain.connect(gainNode);

          hammerGain.gain.setValueAtTime(0.1, now);
          hammerGain.gain.exponentialRampToValueAtTime(0.001, now + 0.03); // Very quick decay

          // Add sympathetic resonance (string vibration simulation)
          const resonanceOscillator = audioContext.createOscillator();
          const resonanceGain = audioContext.createGain();
          const resonanceFilter = audioContext.createBiquadFilter();

          resonanceFilter.type = 'bandpass';
          resonanceFilter.frequency.value = frequency * 3;
          resonanceFilter.Q.value = 8; // Narrow band for resonance

          resonanceOscillator.type = 'sine';
          resonanceOscillator.frequency.value = frequency * 1.003; // Slightly detuned

          resonanceOscillator.connect(resonanceFilter);
          resonanceFilter.connect(resonanceGain);
          resonanceGain.connect(gainNode);

          resonanceGain.gain.setValueAtTime(0, now);
          resonanceGain.gain.linearRampToValueAtTime(0.08, now + 0.01); // Delayed resonance
          resonanceGain.gain.exponentialRampToValueAtTime(0.02, now + duration);

          // Add harmonic partials (overtones for piano richness)
          const harmonic1 = audioContext.createOscillator();
          const harmonicGain1 = audioContext.createGain();

          harmonic1.type = "sine";
          harmonic1.frequency.value = frequency * 2; // Octave
          harmonicGain1.gain.setValueAtTime(0, now);
          harmonicGain1.gain.linearRampToValueAtTime(0.2, now + attackTime);
          harmonicGain1.gain.exponentialRampToValueAtTime(0.03, now + duration);

          harmonic1.connect(harmonicGain1);
          harmonicGain1.connect(gainNode);

          const harmonic2 = audioContext.createOscillator();
          const harmonicGain2 = audioContext.createGain();

          harmonic2.type = "sine";
          harmonic2.frequency.value = frequency * 3; // Fifth above octave
          harmonicGain2.gain.setValueAtTime(0, now);
          harmonicGain2.gain.linearRampToValueAtTime(0.12, now + attackTime);
          harmonicGain2.gain.exponentialRampToValueAtTime(0.02, now + duration);

          harmonic2.connect(harmonicGain2);
          harmonicGain2.connect(gainNode);

          const harmonic3 = audioContext.createOscillator();
          const harmonicGain3 = audioContext.createGain();

          harmonic3.type = "sine";
          harmonic3.frequency.value = frequency * 4; // Two octaves
          harmonicGain3.gain.setValueAtTime(0, now);
          harmonicGain3.gain.linearRampToValueAtTime(0.08, now + attackTime);
          harmonicGain3.gain.exponentialRampToValueAtTime(0.01, now + duration);

          harmonic3.connect(harmonicGain3);
          harmonicGain3.connect(gainNode);

          // Add subtle vibrato for acoustic piano feel
          const vibrato = audioContext.createOscillator();
          const vibratoGain = audioContext.createGain();

          vibrato.frequency.value = 3.5; // Slower vibrato than guitar
          vibratoGain.gain.value = 1; // 1 cent vibrato depth (subtle)

          vibrato.connect(vibratoGain);
          vibratoGain.connect(oscillator.frequency);

          // Start all oscillators
          oscillator.start(now);
          hammerNoise.start(now);
          resonanceOscillator.start(now);
          harmonic1.start(now);
          harmonic2.start(now);
          harmonic3.start(now);
          vibrato.start(now);

          // Stop all oscillators
          oscillator.stop(now + duration);
          hammerNoise.stop(now + duration);
          resonanceOscillator.stop(now + duration);
          harmonic1.stop(now + duration);
          harmonic2.stop(now + duration);
          harmonic3.stop(now + duration);
          vibrato.stop(now + duration);

          oscillator.onended = resolve;
        });
      }

      // Sleep utility
      function sleep(ms) {
        return new Promise((resolve) => setTimeout(resolve, ms));
      }

      // Guitar fretboard rendering
      function renderGuitarFretboard(scaleNotes, scaleIndex) {
        const fretboard = document.getElementById(`fretboard-${scaleIndex}`);
        if (!fretboard) return;

        fretboard.innerHTML = '';

        // Standard guitar tuning reversed (low to high, displayed high to low)
        const tuning = ['E', 'B', 'G', 'D', 'A', 'E']; // High E to Low E (bottom to top)
        const numFrets = 12;

        // Create container for fretboard
        const fretboardContainer = document.createElement('div');
        fretboardContainer.style.position = 'relative';

        // Add fret numbers above the fretboard
        const fretNumberRow = document.createElement('div');
        fretNumberRow.style.display = 'flex';
        fretNumberRow.style.marginBottom = '8px';

        // Add fret 0 position
        const fretZero = document.createElement('div');
        fretZero.style.flex = '1';
        fretZero.style.minWidth = '45px';
        fretZero.style.display = 'flex';
        fretZero.style.alignItems = 'center';
        fretZero.style.justifyContent = 'center';
        fretZero.textContent = '0';
        fretZero.style.fontSize = '0.7rem';
        fretZero.style.fontWeight = '600';
        fretZero.style.color = 'var(--text-secondary)';
        fretNumberRow.appendChild(fretZero);

        for (let fret = 1; fret <= numFrets; fret++) {
          const fretNumberCell = document.createElement('div');
          fretNumberCell.style.flex = '1';
          fretNumberCell.style.minWidth = '45px';
          fretNumberCell.style.display = 'flex';
          fretNumberCell.style.justifyContent = 'center';
          fretNumberCell.style.alignItems = 'center';
          fretNumberCell.style.fontSize = '0.7rem';
          fretNumberCell.style.fontWeight = '600';
          fretNumberCell.style.color = 'var(--text-secondary)';
          fretNumberCell.textContent = fret;

          fretNumberRow.appendChild(fretNumberCell);
        }

        fretboard.appendChild(fretNumberRow);

        // Create strings
        tuning.forEach((openNote, stringIndex) => {
          const string = document.createElement('div');
          string.className = 'string';

          // String line
          const stringLine = document.createElement('div');
          stringLine.className = 'string-line';
          stringLine.style.left = '0px'; // Remove space for string labels
          string.appendChild(stringLine);

          // Add open position (fret 0)
          const openFretElement = document.createElement('div');
          openFretElement.className = 'fret';
          openFretElement.style.minWidth = '45px';
          openFretElement.style.borderRight = '2px solid var(--border-color)';

          // Calculate note for open string
          const openNoteIndex = getNoteIndex(openNote);
          const note = NOTES[openNoteIndex];

          // Add note marker for open string
          const openNoteMarker = document.createElement('div');
          openNoteMarker.className = scaleNotes.includes(note) ? 'note-marker in-scale' : 'note-marker';
          openNoteMarker.textContent = note;
          openNoteMarker.onclick = () => playGuitarNote({ target: openNoteMarker }, note, stringIndex, 0);
          openFretElement.appendChild(openNoteMarker);

          string.appendChild(openFretElement);

          // Add frets 1-12
          for (let fret = 1; fret <= numFrets; fret++) {
            const fretElement = document.createElement('div');
            fretElement.className = 'fret';

            // Highlight double fret positions
            if ([3, 5, 7, 9, 12].includes(fret)) {
              fretElement.style.borderRightWidth = '3px';
              fretElement.style.borderRightColor = '#999';
            }

            // Calculate note at this fret
            const noteIndex = (openNoteIndex + fret) % 12;
            const fretNote = NOTES[noteIndex];

            // Add note marker
            const noteMarker = document.createElement('div');
            noteMarker.className = scaleNotes.includes(fretNote) ? 'note-marker in-scale' : 'note-marker';
            noteMarker.textContent = fretNote;
            noteMarker.onclick = () => playGuitarNote({ target: noteMarker }, fretNote, stringIndex, fret);
            fretElement.appendChild(noteMarker);

            string.appendChild(fretElement);
          }

          fretboardContainer.appendChild(string);
        });

        fretboard.appendChild(fretboardContainer);
      }

      // Piano keyboard rendering
      function renderPianoKeyboard(scaleNotes, scaleIndex) {
        const keyboard = document.getElementById(`keyboard-${scaleIndex}`);
        if (!keyboard) return;

        keyboard.innerHTML = '';

        // Create one octave with correct chromatic sequence
        const whiteKeys = ['C', 'D', 'E', 'F', 'G', 'A', 'B'];

        // Define black keys with their positions between white keys
        // C# between C-D, D# between D-E, F# between F-G, G# between G-A, A# between A-B
        const blackKeysMap = [
          { note: 'C#', between: [0, 1] }, // Between C (0) and D (1)
          { note: 'D#', between: [1, 2] }, // Between D (1) and E (2)
          { note: 'F#', between: [3, 4] }, // Between F (3) and G (4)
          { note: 'G#', between: [4, 5] }, // Between G (4) and A (5)
          { note: 'A#', between: [5, 6] }, // Between A (5) and B (6)
        ];

        // Create white keys
        whiteKeys.forEach((note, index) => {
          const key = document.createElement('div');
          key.className = 'key white-key';

          if (scaleNotes.includes(note)) {
            key.classList.add('in-scale');
          }

          const label = document.createElement('div');
          label.className = 'key-label';
          label.textContent = note;
          key.appendChild(label);

          key.onclick = () => playNoteClick({ target: key }, note);
          keyboard.appendChild(key);
        });

        // Create black keys (positioned absolutely)
        setTimeout(() => {
          const whiteKeyElements = keyboard.querySelectorAll('.white-key');
          const blackKeyWidth = window.innerWidth <= 600 ? 25 : 35; // Updated widths for better usability

          blackKeysMap.forEach((blackKeyData) => {
            const blackKey = document.createElement('div');
            blackKey.className = 'key black-key';

            // Get the white keys this black key sits between
            const leftWhiteKey = whiteKeyElements[blackKeyData.between[0]];
            const rightWhiteKey = whiteKeyElements[blackKeyData.between[1]];

            if (leftWhiteKey && rightWhiteKey) {
              const leftPosition = leftWhiteKey.offsetLeft;
              const rightPosition = rightWhiteKey.offsetLeft;
              const whiteKeyWidth = leftWhiteKey.offsetWidth;

              // Position the black key so it overlaps slightly with both adjacent white keys
              // This is how real pianos work - black keys sit between white keys
              const blackKeyPosition = leftPosition + whiteKeyWidth - (blackKeyWidth / 2);

              blackKey.style.left = `${blackKeyPosition}px`;
            }

            if (scaleNotes.includes(blackKeyData.note)) {
              blackKey.classList.add('in-scale');
            }

            const label = document.createElement('div');
            label.className = 'key-label';
            label.textContent = blackKeyData.note;
            blackKey.appendChild(label);

            blackKey.onclick = () => playNoteClick({ target: blackKey }, blackKeyData.note);
            keyboard.appendChild(blackKey);
          });
        }, 0);
      }

      // Update instrument visualizations
      function updateInstrumentVisualizations() {
        const matches = findMatchingScales();
        const hasSelectedScale = selectedScaleIndex !== null && matches.length > selectedScaleIndex;

        if (hasSelectedScale) {
          const selectedScale = matches[selectedScaleIndex];
          const scaleNotes = selectedScale.notes;

          // Render instruments in the scale-specific containers
          renderGuitarFretboard(scaleNotes, selectedScaleIndex);
          renderPianoKeyboard(scaleNotes, selectedScaleIndex);
        }
      }

      // Initialize
      createPianoSelector();

      // Add keyboard event listeners
      document.addEventListener("keypress", handleKeyPress);
      document.addEventListener("keydown", handleKeyDown);
    </script>
  </body>
</html>
